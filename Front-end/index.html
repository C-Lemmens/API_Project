<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todo App</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>To-do list</h1>
    <div id="container">
    <div id="uncompletedTodoList">
        <h2>Uncompleted Tasks</h2>
        <!-- Populated by JavaScript -->
    </div>
    <div id="completedTodoList">
        <h2>Completed Tasks</h2>
        <!-- Populated by JavaScript -->
    </div>
    <form id="addTodoForm">
        <input type="text" id="task">
        <button type="submit"><i class="fas fa-plus"></i></button>
    </form>
</div>

    <script>
$(document).ready(function() {
function fetchTodos() {
    $.get("https://api-c-lemmens.cloud.okteto.net/todos", function(data) {
        $("#uncompletedTodoList").empty();
        $("#completedTodoList").empty();

        data.todos.forEach(function(todo) {
            const targetDiv = todo.completed ? "#completedTodoList" : "#uncompletedTodoList";
            const checked = todo.completed ? 'checked' : '';
            $(targetDiv).append(`
                <div class="todoItem" id="todo-${todo.id}">
                    <input type="checkbox" id="checkbox-${todo.id}" onclick="toggleCompleted(${todo.id})" ${checked}>
                    <label for="checkbox-${todo.id}"></label>
                    <span id="text-${todo.id}">${todo.task}</span>
                    <button onclick="editTodo(${todo.id})" id="edit-button-${todo.id}" class="icon-button edit-button">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="saveTodo(${todo.id})" id="save-button-${todo.id}" class="icon-button save-button" style="display:none;">
                        <i class="fas fa-save"></i>
                    </button>
                    <button onclick="deleteTodo(${todo.id})" class="icon-button delete-button">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
            `);
        });
    });
}

function toggleCompleted(todoId) {
    const todoElement = $(`#todo-${todoId}`);
    const isChecked = $(`#checkbox-${todoId}`).prop('checked');

    $.ajax({
        url: `https://api-c-lemmens.cloud.okteto.net/todos/${todoId}`,
        type: 'PUT',
        contentType: 'application/json',
        data: JSON.stringify({ completed: isChecked }),
        success: function() {
            fetchTodos();
        }
    });
}

    function deleteTodo(todoId) {
        $.ajax({
            url: `https://api-c-lemmens.cloud.okteto.net/todos/${todoId}`,
            type: 'DELETE',
            success: function() {
                fetchTodos();
            }
        });
    }

    function editTodo(todoId) {
    $(`#text-${todoId}`).hide();
    $(`#edit-button-${todoId}`).hide();
    $(`#edit-input-${todoId}`).show();
    $(`#save-button-${todoId}`).show();
    $(`#edit-input-${todoId}`).focus(); // Add this line to set focus
}

    function saveTodo(todoId) {
    const updatedTask = $(`#edit-input-${todoId}`).val();
    $.ajax({
        url: `https://api-c-lemmens.cloud.okteto.net/todos/${todoId}`,
        type: 'PUT',
        contentType: 'application/json', // Make sure to set the content type
        data: JSON.stringify({ task: updatedTask }),
        success: function() {
            fetchTodos();
        }
    });
}

    $("#addTodoForm").submit(function(e) {
        e.preventDefault();
        const task = $("#task").val();
        $.ajax({
            url: "https://api-c-lemmens.cloud.okteto.net/todos",
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ task: task }),
            success: function() {
                $("#task").val("");
                fetchTodos();
            },
            error: function(error) {
                console.log("Error:", error);
            }
        });
    });

    window.deleteTodo = deleteTodo; // Make accessible from HTML
    window.editTodo = editTodo; // Make accessible from HTML
    window.saveTodo = saveTodo; // Make accessible from HTML

    fetchTodos(); // Initial fetch
    window.toggleCompleted = toggleCompleted; // Make accessible from HTML
});

    </script>
</body>
</html>
